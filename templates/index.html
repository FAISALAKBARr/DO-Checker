<!doctype html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>DO Checker ‚Äî DMC</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=DM+Sans:wght@300;400;500;600&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --bg: #0b0d11;
        --surface: #13161d;
        --surface2: #1a1e28;
        --border: #242832;
        --border2: #2e3340;
        --accent: #00e5a0;
        --accent-bg: rgba(0, 229, 160, 0.08);
        --red: #ff4d6d;
        --red-bg: rgba(255, 77, 109, 0.09);
        --yellow: #ffc947;
        --yellow-bg: rgba(255, 201, 71, 0.09);
        --blue: #60a5fa;
        --blue-bg: rgba(96, 165, 250, 0.09);
        --text: #dde3f0;
        --muted: #5c6475;
        --muted2: #8892a4;
        --mono: "Space Mono", monospace;
        --sans: "DM Sans", sans-serif;
      }
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
      html {
        scroll-behavior: smooth;
      }
      body {
        background: var(--bg);
        color: var(--text);
        font-family: var(--sans);
        min-height: 100vh;
      }

      /* ‚ïê‚ïê HEADER ‚ïê‚ïê */
      header {
        border-bottom: 1px solid var(--border);
        padding: 13px 28px;
        display: flex;
        align-items: center;
        gap: 12px;
        background: var(--bg);
        position: sticky;
        top: 0;
        z-index: 100;
      }
      .logo {
        background: var(--accent);
        color: #000;
        font-family: var(--mono);
        font-size: 11px;
        font-weight: 700;
        padding: 4px 10px;
        letter-spacing: 0.1em;
      }
      header h1 {
        font-family: var(--mono);
        font-size: 13px;
        color: var(--muted2);
        font-weight: 400;
      }
      header h1 strong {
        color: var(--text);
      }
      .live {
        margin-left: auto;
        display: flex;
        align-items: center;
        gap: 7px;
        font-size: 11px;
        font-family: var(--mono);
        color: var(--muted);
      }
      .live-dot {
        width: 6px;
        height: 6px;
        border-radius: 50%;
        background: var(--accent);
        box-shadow: 0 0 6px var(--accent);
        animation: blink 2s infinite;
      }
      @keyframes blink {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.3;
        }
      }

      /* ‚ïê‚ïê MAIN ‚ïê‚ïê */
      main {
        max-width: 820px;
        margin: 0 auto;
        padding: 36px 20px 80px;
      }
      .page-head {
        margin-bottom: 28px;
      }
      .page-head h2 {
        font-size: 26px;
        font-weight: 600;
        letter-spacing: -0.02em;
        line-height: 1.2;
      }
      .page-head p {
        color: var(--muted2);
        font-size: 13px;
        margin-top: 7px;
        line-height: 1.7;
      }

      /* ‚ïê‚ïê STEP INDICATOR ‚ïê‚ïê */
      .steps {
        display: flex;
        gap: 0;
        margin-bottom: 28px;
        border: 1px solid var(--border);
        border-radius: 6px;
        overflow: hidden;
      }
      .step-item {
        flex: 1;
        padding: 10px 14px;
        font-family: var(--mono);
        font-size: 11px;
        letter-spacing: 0.06em;
        color: var(--muted);
        border-right: 1px solid var(--border);
        display: flex;
        align-items: center;
        gap: 8px;
        background: var(--surface);
        transition: all 0.2s;
      }
      .step-item:last-child {
        border-right: none;
      }
      .step-item.active {
        color: var(--accent);
        background: var(--accent-bg);
      }
      .step-item.done {
        color: var(--muted2);
      }
      .step-item.done .step-num {
        background: var(--border);
        color: var(--muted2);
      }
      .step-num {
        width: 20px;
        height: 20px;
        border-radius: 50%;
        background: var(--border);
        color: var(--muted);
        font-size: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
        font-weight: 700;
      }
      .step-item.active .step-num {
        background: var(--accent);
        color: #000;
      }

      /* ‚ïê‚ïê UPLOAD ‚ïê‚ïê */
      .upload-zone {
        border: 1.5px dashed var(--border2);
        border-radius: 6px;
        padding: 44px 24px;
        text-align: center;
        cursor: pointer;
        transition: all 0.2s;
        background: var(--surface);
        position: relative;
        margin-bottom: 16px;
      }
      .upload-zone input {
        position: absolute;
        inset: 0;
        opacity: 0;
        cursor: pointer;
        width: 100%;
        height: 100%;
      }
      .upload-zone:hover,
      .upload-zone.drag {
        border-color: var(--accent);
        background: var(--accent-bg);
      }
      .upload-icon {
        font-size: 36px;
        margin-bottom: 12px;
      }
      .upload-zone h3 {
        font-size: 15px;
        font-weight: 500;
        margin-bottom: 5px;
      }
      .upload-zone small {
        color: var(--muted2);
        font-size: 12px;
      }
      .upload-hint {
        margin-top: 14px;
        font-family: var(--mono);
        font-size: 10px;
        color: var(--muted);
        letter-spacing: 0.08em;
      }

      /* ‚ïê‚ïê PREVIEW ‚ïê‚ïê */
      #preview-wrap {
        display: none;
        border: 1px solid var(--border);
        border-radius: 6px;
        overflow: hidden;
        background: var(--surface);
        margin-bottom: 16px;
      }
      .preview-bar {
        padding: 10px 14px;
        border-bottom: 1px solid var(--border);
        display: flex;
        align-items: center;
        justify-content: space-between;
      }
      .preview-bar span {
        font-size: 12px;
        font-family: var(--mono);
        color: var(--accent);
      }
      #remove-btn {
        background: none;
        border: 1px solid var(--border);
        color: var(--muted2);
        padding: 3px 10px;
        cursor: pointer;
        font-size: 11px;
        font-family: var(--mono);
        border-radius: 3px;
        transition: all 0.2s;
      }
      #remove-btn:hover {
        border-color: var(--red);
        color: var(--red);
      }
      #preview-img {
        width: 100%;
        max-height: 280px;
        object-fit: contain;
        padding: 12px;
      }

      /* ‚ïê‚ïê BUTTONS ‚ïê‚ïê */
      .btn-primary {
        width: 100%;
        padding: 13px;
        background: var(--accent);
        color: #000;
        border: none;
        font-family: var(--mono);
        font-size: 12px;
        font-weight: 700;
        letter-spacing: 0.1em;
        cursor: pointer;
        border-radius: 4px;
        transition: all 0.2s;
        margin-bottom: 12px;
      }
      .btn-primary:hover:not(:disabled) {
        background: #00ffaa;
      }
      .btn-primary:disabled {
        background: var(--border);
        color: var(--muted);
        cursor: not-allowed;
      }

      /* ‚ïê‚ïê BANDUL INPUT (step 2) ‚ïê‚ïê */
      #bandul-section {
        display: none;
        background: var(--yellow-bg);
        border: 1.5px solid var(--yellow);
        border-radius: 6px;
        padding: 20px 22px;
        margin-bottom: 16px;
      }
      .bandul-title {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 12px;
      }
      .bandul-title h3 {
        font-size: 14px;
        font-weight: 600;
      }
      .bandul-title .ico {
        font-size: 20px;
      }
      .bandul-desc {
        font-size: 13px;
        color: var(--muted2);
        line-height: 1.7;
        margin-bottom: 16px;
        padding: 10px 14px;
        background: var(--surface2);
        border-radius: 4px;
        font-family: var(--mono);
        font-size: 12px;
        border-left: 3px solid var(--yellow);
      }
      .bandul-desc strong {
        color: var(--yellow);
      }
      .bandul-input-row {
        display: flex;
        gap: 10px;
        align-items: flex-end;
      }
      .input-group {
        flex: 1;
      }
      .input-group label {
        display: block;
        font-size: 11px;
        font-family: var(--mono);
        letter-spacing: 0.08em;
        color: var(--muted2);
        margin-bottom: 6px;
      }
      .input-group input[type="number"] {
        width: 100%;
        padding: 10px 14px;
        background: var(--surface);
        border: 1px solid var(--border2);
        border-radius: 4px;
        color: var(--text);
        font-family: var(--mono);
        font-size: 15px;
        outline: none;
        transition: border-color 0.2s;
      }
      .input-group input:focus {
        border-color: var(--yellow);
      }
      .bandul-info {
        flex-shrink: 0;
        background: var(--surface2);
        border: 1px solid var(--border2);
        border-radius: 4px;
        padding: 10px 14px;
        font-size: 12px;
        font-family: var(--mono);
        color: var(--muted2);
        line-height: 1.6;
      }
      .bandul-info span {
        color: var(--yellow);
        font-weight: 700;
      }

      /* ‚ïê‚ïê LOADING ‚ïê‚ïê */
      #loading {
        display: none;
        text-align: center;
        padding: 44px;
        border: 1px solid var(--border);
        border-radius: 6px;
        background: var(--surface);
        margin-bottom: 28px;
      }
      .spinner {
        width: 34px;
        height: 34px;
        border: 2px solid var(--border2);
        border-top-color: var(--accent);
        border-radius: 50%;
        animation: spin 0.8s linear infinite;
        margin: 0 auto 16px;
      }
      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }
      #loading p {
        font-size: 13px;
        color: var(--muted2);
      }
      #loading .step {
        font-size: 11px;
        font-family: var(--mono);
        color: var(--accent);
        margin-top: 7px;
      }

      /* ‚ïê‚ïê ERROR ‚ïê‚ïê */
      .error-box {
        background: var(--red-bg);
        border: 1px solid var(--red);
        border-radius: 4px;
        padding: 13px 18px;
        margin-bottom: 16px;
        font-size: 13px;
        color: var(--red);
        font-family: var(--mono);
      }

      /* ‚ïê‚ïê RESULTS ‚ïê‚ïê */
      #results {
        display: none;
      }

      .banner {
        padding: 18px 22px;
        border-radius: 6px;
        margin-bottom: 28px;
        display: flex;
        align-items: flex-start;
        gap: 14px;
      }
      .banner.ok {
        background: var(--accent-bg);
        border: 1.5px solid var(--accent);
      }
      .banner.error {
        background: var(--red-bg);
        border: 1.5px solid var(--red);
      }
      .banner-ico {
        font-size: 26px;
        flex-shrink: 0;
      }
      .banner-body h3 {
        font-size: 15px;
        font-weight: 600;
        margin-bottom: 4px;
      }
      .banner-body p {
        font-size: 13px;
        color: var(--muted2);
        line-height: 1.6;
      }
      .banner-meta {
        margin-top: 10px;
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
      }
      .meta-tag {
        font-family: var(--mono);
        font-size: 10px;
        letter-spacing: 0.06em;
        padding: 3px 9px;
        border-radius: 3px;
        background: var(--surface2);
        color: var(--muted2);
        border: 1px solid var(--border2);
      }
      .meta-tag.highlight {
        background: var(--accent-bg);
        color: var(--accent);
        border-color: var(--accent);
      }

      .sec-label {
        font-family: var(--mono);
        font-size: 10px;
        letter-spacing: 0.14em;
        text-transform: uppercase;
        color: var(--muted);
        margin-bottom: 10px;
        padding-bottom: 7px;
        border-bottom: 1px solid var(--border);
      }

      /* ‚ïê‚ïê CHECK CARDS ‚ïê‚ïê */
      .checks-list {
        display: flex;
        flex-direction: column;
        gap: 10px;
        margin-bottom: 32px;
      }
      .check-card {
        background: var(--surface);
        border: 1px solid var(--border);
        border-radius: 6px;
        overflow: hidden;
      }
      .check-card.ok {
        border-left: 3px solid var(--accent);
      }
      .check-card.err {
        border-left: 3px solid var(--red);
      }

      .cc-head {
        padding: 12px 16px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 10px;
        cursor: pointer;
        user-select: none;
        transition: background 0.15s;
        flex-wrap: wrap;
      }
      .cc-head:hover {
        background: var(--surface2);
      }
      .cc-left {
        display: flex;
        align-items: center;
        gap: 9px;
        flex: 1;
        min-width: 0;
      }
      .cc-kategori {
        font-family: var(--mono);
        font-size: 9px;
        letter-spacing: 0.1em;
        text-transform: uppercase;
        padding: 2px 7px;
        border-radius: 2px;
        background: var(--surface2);
        color: var(--muted2);
        white-space: nowrap;
        flex-shrink: 0;
      }
      .cc-label {
        font-size: 13px;
        font-weight: 500;
      }
      .cc-right {
        display: flex;
        align-items: center;
        gap: 9px;
        flex-shrink: 0;
      }
      .cc-nums {
        display: flex;
        gap: 18px;
      }
      .cc-num .lbl {
        font-size: 9px;
        font-family: var(--mono);
        color: var(--muted);
        letter-spacing: 0.06em;
        margin-bottom: 2px;
      }
      .cc-num .val {
        font-family: var(--mono);
        font-size: 15px;
        font-weight: 700;
      }
      .cc-num.h .val {
        color: var(--text);
      }
      .cc-num.t .val {
        color: var(--muted2);
        font-size: 13px;
      }
      .check-card.err .cc-num.t .val {
        color: var(--red);
      }
      .selisih-tag {
        font-family: var(--mono);
        font-size: 11px;
        color: var(--red);
        background: var(--red-bg);
        padding: 2px 8px;
        border-radius: 3px;
        white-space: nowrap;
      }
      .badge {
        font-family: var(--mono);
        font-size: 10px;
        font-weight: 700;
        padding: 3px 8px;
        border-radius: 3px;
        white-space: nowrap;
      }
      .badge.ok {
        background: var(--accent-bg);
        color: var(--accent);
      }
      .badge.err {
        background: var(--red-bg);
        color: var(--red);
      }
      .cc-arrow {
        font-size: 11px;
        color: var(--muted);
        transition: transform 0.2s;
        flex-shrink: 0;
      }
      .cc-arrow.open {
        transform: rotate(180deg);
      }

      /* card body */
      .cc-body {
        display: none;
        border-top: 1px solid var(--border);
      }
      .cc-body.show {
        display: block;
      }
      .rincian-wrap {
        padding: 14px 16px;
      }
      .rincian-title {
        font-family: var(--mono);
        font-size: 10px;
        letter-spacing: 0.1em;
        color: var(--muted);
        text-transform: uppercase;
        margin-bottom: 10px;
      }

      .formula-box {
        background: var(--surface2);
        border: 1px solid var(--border2);
        border-radius: 4px;
        padding: 12px 14px;
        font-family: var(--mono);
        font-size: 12px;
        line-height: 2;
        overflow-x: auto;
        margin-bottom: 10px;
      }
      .formula-box .fn {
        color: var(--text);
      }
      .formula-box .res {
        color: var(--accent);
        font-weight: 700;
      }
      .formula-box .op {
        color: var(--muted);
        margin: 0 3px;
      }
      .formula-box .note {
        color: var(--muted2);
        font-size: 11px;
        display: block;
        margin-top: 4px;
      }
      .formula-box .line {
        display: block;
        padding: 1px 0;
      }
      .formula-box .line.derived {
        color: var(--blue);
      }

      .kesimpulan {
        font-size: 12px;
        padding: 10px 14px;
        border-radius: 4px;
        line-height: 1.7;
        font-family: var(--mono);
      }
      .kesimpulan.ok {
        background: var(--accent-bg);
        color: var(--accent);
      }
      .kesimpulan.err {
        background: var(--red-bg);
        color: var(--red);
      }

      /* ‚ïê‚ïê DATA TABLES ‚ïê‚ïê */
      .grp-tables {
        display: flex;
        flex-direction: column;
        gap: 16px;
        margin-bottom: 32px;
      }
      .grp-table-card {
        border: 1px solid var(--border);
        border-radius: 6px;
        overflow: hidden;
      }
      .grp-table-head {
        padding: 10px 14px;
        background: var(--surface2);
        font-size: 12px;
        font-family: var(--mono);
        display: flex;
        align-items: center;
        justify-content: space-between;
      }
      .grp-table-head span {
        color: var(--accent);
      }
      .tbl-wrap {
        overflow-x: auto;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        font-size: 12px;
      }
      th {
        background: var(--surface2);
        font-family: var(--mono);
        font-size: 10px;
        letter-spacing: 0.07em;
        color: var(--muted);
        padding: 9px 14px;
        text-align: right;
        border-bottom: 1px solid var(--border);
      }
      th:first-child {
        text-align: center;
      }
      td {
        padding: 8px 14px;
        text-align: right;
        border-bottom: 1px solid #191d26;
        font-family: var(--mono);
        font-size: 12px;
      }
      td:first-child {
        text-align: center;
        color: var(--muted);
      }
      tr:last-child td {
        border-bottom: none;
      }
      .tfoot-row td {
        background: var(--surface2);
        border-top: 1px solid var(--border);
        font-weight: 700;
        font-family: var(--mono);
      }
      .val-hitung {
        color: var(--accent);
      }
      .val-tertulis {
        color: var(--muted2);
      }
      .val-mismatch {
        color: var(--red) !important;
      }
      .val-label {
        text-align: center !important;
        color: var(--muted);
        font-size: 10px;
        letter-spacing: 0.06em;
      }

      /* ‚ïê‚ïê BARIS RAGU ‚ïê‚ïê */
      .ragu-banner {
        background: var(--yellow-bg);
        border: 1.5px solid var(--yellow);
        border-radius: 6px;
        padding: 14px 18px;
        margin-bottom: 24px;
        display: flex;
        gap: 12px;
        align-items: flex-start;
      }
      .ragu-banner-ico {
        font-size: 20px;
        flex-shrink: 0;
        margin-top: 1px;
      }
      .ragu-banner-body h4 {
        font-size: 13px;
        font-weight: 600;
        color: var(--yellow);
        margin-bottom: 6px;
      }
      .ragu-banner-body p {
        font-size: 12px;
        color: var(--muted2);
        line-height: 1.6;
        margin-bottom: 8px;
      }
      .ragu-list {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
      }
      .ragu-item {
        font-family: var(--mono);
        font-size: 11px;
        padding: 3px 10px;
        border-radius: 3px;
        background: rgba(255, 201, 71, 0.15);
        color: var(--yellow);
        border: 1px solid rgba(255, 201, 71, 0.3);
      }

      .row-ragu td {
        background: rgba(255, 201, 71, 0.06) !important;
      }
      .row-ragu td:first-child::after {
        content: " ‚ö†";
        color: var(--yellow);
        font-size: 10px;
      }

      .retry-tag {
        background: var(--blue-bg);
        color: var(--blue);
        border-color: var(--blue);
      }

      /* ‚ïê‚ïê PANEL KOREKSI NILAI EKSTRAKSI ‚ïê‚ïê */
      .ext-panel {
        border: 1px solid var(--border2);
        border-radius: 6px;
        overflow: hidden;
        margin-bottom: 32px;
      }
      .ext-panel-head {
        padding: 11px 16px;
        background: var(--surface2);
        display: flex;
        align-items: center;
        justify-content: space-between;
        border-bottom: 1px solid var(--border);
      }
      .ext-panel-head h4 {
        font-family: var(--mono);
        font-size: 11px;
        letter-spacing: 0.08em;
        color: var(--muted2);
        font-weight: 400;
      }
      .ext-panel-hint {
        font-family: var(--mono);
        font-size: 10px;
        color: var(--muted);
        letter-spacing: 0.04em;
      }
      .ext-panel-body {
        padding: 16px;
        display: flex;
        flex-direction: column;
        gap: 14px;
      }

      /* Satu kelompok dalam panel */
      .ext-group {
        display: flex;
        flex-direction: column;
        gap: 8px;
      }
      .ext-group-label {
        font-family: var(--mono);
        font-size: 10px;
        letter-spacing: 0.1em;
        text-transform: uppercase;
        color: var(--accent);
        padding-bottom: 6px;
        border-bottom: 1px solid var(--border);
      }
      .ext-fields {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
        gap: 8px;
      }

      /* Satu field editable */
      .ext-field {
        background: var(--surface);
        border: 1px solid var(--border2);
        border-radius: 4px;
        padding: 10px 12px;
        cursor: pointer;
        transition: all 0.15s;
        position: relative;
      }
      .ext-field:hover {
        border-color: var(--yellow);
        background: rgba(255, 201, 71, 0.05);
      }
      .ext-field .ef-label {
        font-family: var(--mono);
        font-size: 9px;
        letter-spacing: 0.1em;
        text-transform: uppercase;
        color: var(--muted);
        margin-bottom: 4px;
      }
      .ext-field .ef-val {
        font-family: var(--mono);
        font-size: 18px;
        font-weight: 700;
        color: var(--text);
        line-height: 1;
      }
      .ext-field .ef-unit {
        font-size: 10px;
        font-weight: 400;
        color: var(--muted);
        margin-left: 3px;
      }
      .ext-field .ef-edit-hint {
        position: absolute;
        top: 6px;
        right: 8px;
        font-size: 10px;
        color: var(--muted);
        opacity: 0;
        transition: opacity 0.15s;
      }
      .ext-field:hover .ef-edit-hint {
        opacity: 1;
      }

      /* Field sedang diedit */
      .ext-field.ef-editing {
        border-color: var(--yellow);
        background: rgba(255, 201, 71, 0.08);
        padding: 0;
      }
      .ext-field.ef-editing input {
        width: 100%;
        padding: 10px 12px;
        background: transparent;
        border: none;
        outline: none;
        font-family: var(--mono);
        font-size: 18px;
        font-weight: 700;
        color: var(--yellow);
      }

      /* Field yang sudah dikoreksi */
      .ext-field.ef-edited {
        border-color: rgba(255, 201, 71, 0.5);
        background: rgba(255, 201, 71, 0.06);
      }
      .ext-field.ef-edited .ef-val {
        color: var(--yellow);
      }
      .ext-field.ef-edited .ef-label::after {
        content: " ‚úé";
        color: var(--yellow);
      }
      .ext-field.ef-edited .ef-orig {
        font-family: var(--mono);
        font-size: 10px;
        color: var(--muted);
        text-decoration: line-through;
        margin-top: 2px;
      }
      /* Header tabel dengan tombol edit mode */
      .grp-table-head .edit-toggle {
        font-family: var(--mono);
        font-size: 10px;
        letter-spacing: 0.06em;
        padding: 3px 10px;
        border-radius: 3px;
        cursor: pointer;
        background: var(--surface);
        border: 1px solid var(--border2);
        color: var(--muted2);
        transition: all 0.2s;
        user-select: none;
      }
      .grp-table-head .edit-toggle:hover {
        border-color: var(--yellow);
        color: var(--yellow);
      }
      .grp-table-head .edit-toggle.active {
        background: var(--yellow-bg);
        border-color: var(--yellow);
        color: var(--yellow);
      }

      /* Sel yang bisa diedit */
      td.editable {
        cursor: pointer;
        position: relative;
        transition: background 0.15s;
      }
      td.editable:hover {
        background: rgba(255, 201, 71, 0.08);
      }
      td.editable::after {
        content: "‚úé";
        font-size: 9px;
        color: var(--muted);
        position: absolute;
        top: 3px;
        right: 4px;
        opacity: 0;
        transition: opacity 0.15s;
      }
      td.editable:hover::after {
        opacity: 1;
      }

      /* Sel yang sedang diedit */
      td.editing {
        background: rgba(255, 201, 71, 0.1) !important;
        padding: 0 !important;
      }
      td.editing input {
        width: 100%;
        height: 100%;
        padding: 8px 14px;
        background: transparent;
        border: 1.5px solid var(--yellow);
        color: var(--yellow);
        font-family: var(--mono);
        font-size: 12px;
        text-align: right;
        outline: none;
        border-radius: 0;
      }

      /* Sel yang sudah diubah */
      td.edited {
        background: rgba(255, 201, 71, 0.07) !important;
        color: var(--yellow) !important;
      }
      td.edited::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 3px;
        height: 100%;
        background: var(--yellow);
      }
      td.edited {
        position: relative;
      }

      /* Baris yang ada perubahan */
      tr.row-edited {
        background: rgba(255, 201, 71, 0.04);
      }

      /* Sel tertulis yang bisa diedit (di footer) */
      td.editable-tertulis {
        cursor: pointer;
        position: relative;
        transition: background 0.15s;
      }
      td.editable-tertulis:hover {
        background: rgba(255, 201, 71, 0.1);
      }
      td.editable-tertulis.editing {
        background: rgba(255, 201, 71, 0.15) !important;
        padding: 0 !important;
      }
      td.editable-tertulis.editing input {
        width: 100%;
        height: 100%;
        padding: 8px 14px;
        background: transparent;
        border: 1.5px solid var(--yellow);
        color: var(--yellow);
        font-family: var(--mono);
        font-size: 12px;
        text-align: right;
        outline: none;
      }
      td.editable-tertulis.edited-tertulis {
        color: var(--yellow) !important;
      }

      /* ‚ïê‚ïê FLOATING RECALCULATE BAR ‚ïê‚ïê */
      #recalc-bar {
        display: none;
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        z-index: 200;
        background: #13161df0;
        border-top: 1.5px solid var(--yellow);
        backdrop-filter: blur(12px);
        padding: 14px 24px;
      }
      .recalc-inner {
        max-width: 820px;
        margin: 0 auto;
        display: flex;
        align-items: center;
        gap: 16px;
      }
      .recalc-info {
        flex: 1;
      }
      .recalc-info strong {
        font-size: 13px;
        color: var(--yellow);
        display: block;
        margin-bottom: 2px;
      }
      .recalc-info span {
        font-size: 11px;
        font-family: var(--mono);
        color: var(--muted2);
      }
      .recalc-changes {
        display: flex;
        flex-wrap: wrap;
        gap: 5px;
        margin-top: 6px;
      }
      .change-chip {
        font-family: var(--mono);
        font-size: 10px;
        padding: 2px 8px;
        border-radius: 2px;
        background: rgba(255, 201, 71, 0.15);
        color: var(--yellow);
        border: 1px solid rgba(255, 201, 71, 0.3);
      }
      .recalc-btn {
        padding: 10px 20px;
        background: var(--yellow);
        color: #000;
        border: none;
        font-family: var(--mono);
        font-size: 12px;
        font-weight: 700;
        letter-spacing: 0.08em;
        cursor: pointer;
        border-radius: 4px;
        white-space: nowrap;
        transition: all 0.2s;
        flex-shrink: 0;
      }
      .recalc-btn:hover {
        background: #ffd966;
      }
      .recalc-discard {
        padding: 10px 14px;
        background: none;
        color: var(--muted2);
        border: 1px solid var(--border2);
        font-family: var(--mono);
        font-size: 11px;
        cursor: pointer;
        border-radius: 4px;
        white-space: nowrap;
        transition: all 0.2s;
        flex-shrink: 0;
      }
      .recalc-discard:hover {
        color: var(--red);
        border-color: var(--red);
      }

      @media (max-width: 580px) {
        .cc-nums {
          gap: 10px;
        }
        .cc-num .val {
          font-size: 13px;
        }
        .cc-kategori {
          display: none;
        }
      }
    </style>
  </head>
  <body>
    <header>
      <div class="logo">DMC</div>
      <h1><strong>DO Checker</strong> ¬∑ Sistem Koreksi Laporan</h1>
      <div class="live">
        <div class="live-dot"></div>
        ONLINE
      </div>
    </header>

    <main>
      <div class="page-head">
        <h2>Verifikasi Laporan<br />Delivery Order</h2>
        <p>
          Sistem membaca foto DO ‚Üí menghitung ulang semua total ‚Üí menampilkan<br />rincian
          penjumlahan lengkap beserta kesimpulan benar/salah per nilai.
        </p>
      </div>

      <!-- Step indicator -->
      <div class="steps">
        <div class="step-item active" id="step1-indicator">
          <div class="step-num">1</div>
          UPLOAD & BACA
        </div>
        <div class="step-item" id="step2-indicator">
          <div class="step-num">2</div>
          INPUT BANDUL
        </div>
        <div class="step-item" id="step3-indicator">
          <div class="step-num">3</div>
          HASIL KOREKSI
        </div>
      </div>

      <!-- STEP 1: Upload -->
      <div id="step1-section">
        <div class="upload-zone" id="drop-zone">
          <input type="file" id="file-input" accept="image/*" />
          <div class="upload-icon">üìã</div>
          <h3>Upload Foto Laporan DO</h3>
          <small>Drag & drop atau klik untuk pilih gambar</small>
          <div class="upload-hint">JPG ¬∑ PNG ¬∑ WEBP ¬∑ MAKS 16MB</div>
        </div>

        <div id="preview-wrap">
          <div class="preview-bar">
            <span id="fname">‚Äî</span>
            <button id="remove-btn">‚úï Ganti</button>
          </div>
          <img id="preview-img" src="" alt="Preview" />
        </div>

        <div id="error-step1"></div>

        <button id="btn-extract" class="btn-primary" disabled>
          ‚ñ∂ BACA DOKUMEN
        </button>
      </div>

      <!-- STEP 2: Bandul input (muncul jika ada Bruto/Terra) -->
      <div id="bandul-section">
        <div class="bandul-title">
          <span class="ico">‚öñÔ∏è</span>
          <h3>Dokumen memiliki Bruto & Terra ‚Äî Masukkan Nilai Bandul</h3>
        </div>
        <div class="bandul-desc" id="bandul-desc">
          Sistem mendeteksi baris <strong>Bruto</strong> dan
          <strong>Terra</strong> di dokumen ini.<br /><br />
          Terra dihitung sebagai:
          <strong>Nilai Bandul √ó Jumlah Baris Terisi</strong><br />
          Netto dihitung sebagai: <strong>Bruto - Terra</strong><br /><br />
          Masukkan nilai bandul yang digunakan pada pengiriman ini:
        </div>
        <div class="bandul-input-row">
          <div class="input-group">
            <label>NILAI BANDUL (kg per bandul)</label>
            <input
              type="number"
              id="bandul-input"
              placeholder="cth: 17"
              step="0.1"
              min="0"
            />
          </div>
          <div class="bandul-info" id="bandul-preview">
            <span>‚Äî</span>
          </div>
        </div>
        <div id="error-bandul" style="margin-top: 10px"></div>
        <br />
        <button id="btn-validate" class="btn-primary" disabled>
          ‚ñ∂ MULAI VALIDASI
        </button>
      </div>

      <!-- Loading -->
      <div id="loading">
        <div class="spinner"></div>
        <p id="load-msg">Memproses dokumen...</p>
        <div class="step" id="load-step">‚Äî</div>
      </div>

      <!-- STEP 3: Results -->
      <div id="results">
        <div id="banner" class="banner ok">
          <div class="banner-ico" id="banner-ico">‚úÖ</div>
          <div class="banner-body">
            <h3 id="banner-title">‚Äî</h3>
            <p id="banner-sub">‚Äî</p>
            <div class="banner-meta" id="banner-meta"></div>
          </div>
        </div>

        <div class="sec-label">HASIL VERIFIKASI & RINCIAN PERHITUNGAN</div>
        <div class="checks-list" id="checks-list"></div>

        <div class="sec-label">KOREKSI NILAI EKSTRAKSI</div>
        <div id="ext-panel-wrap"></div>

        <div class="sec-label">DATA BARIS TERBACA PER KELOMPOK</div>
        <div class="grp-tables" id="grp-tables"></div>

        <button
          class="btn-primary"
          id="btn-reset"
          style="
            margin-top: 16px;
            background: var(--surface2);
            color: var(--muted2);
            border: 1px solid var(--border2);
          "
        >
          ‚Ü© CEK DOKUMEN BARU
        </button>
      </div>
    </main>

    <!-- Floating Recalculate Bar -->
    <div id="recalc-bar">
      <div class="recalc-inner">
        <div class="recalc-info">
          <strong>Ada perubahan nilai yang belum dihitung ulang</strong>
          <span
            >Klik "Hitung Ulang" untuk memperbarui seluruh hasil validasi</span
          >
          <div class="recalc-changes" id="recalc-changes"></div>
        </div>
        <button class="recalc-discard" id="recalc-discard">‚úï Batalkan</button>
        <button class="recalc-btn" id="recalc-btn">‚ü≥ HITUNG ULANG</button>
      </div>
    </div>

    <script>
      /* ‚ïê‚ïê STATE ‚ïê‚ïê */
      let selectedFile = null;
      let rawData = null;
      let adaBrutoTerra = false;
      let barisRagu = []; // baris yang ditandai ragu oleh Gemini
      let currentBandul = null; // bandul yang terakhir dipakai, untuk recalc

      /* ‚ïê‚ïê DOM ‚ïê‚ïê */
      const fileInput = document.getElementById("file-input");
      const dropZone = document.getElementById("drop-zone");
      const previewWrap = document.getElementById("preview-wrap");
      const previewImg = document.getElementById("preview-img");
      const fname = document.getElementById("fname");
      const removeBtn = document.getElementById("remove-btn");
      const btnExtract = document.getElementById("btn-extract");
      const btnValidate = document.getElementById("btn-validate");
      const bandulSection = document.getElementById("bandul-section");
      const bandulInput = document.getElementById("bandul-input");
      const bandulPreview = document.getElementById("bandul-preview");
      const loading = document.getElementById("loading");
      const loadMsg = document.getElementById("load-msg");
      const loadStep = document.getElementById("load-step");
      const results = document.getElementById("results");
      const btnReset = document.getElementById("btn-reset");

      /* ‚ïê‚ïê UPLOAD HANDLERS ‚ïê‚ïê */
      function setFile(f) {
        if (!f) return;
        selectedFile = f;
        fname.textContent = f.name;
        previewImg.src = URL.createObjectURL(f);
        previewWrap.style.display = "block";
        dropZone.style.display = "none";
        btnExtract.disabled = false;
        clearError("error-step1");
      }

      fileInput.addEventListener("change", () => {
        if (fileInput.files[0]) setFile(fileInput.files[0]);
      });
      dropZone.addEventListener("dragover", (e) => {
        e.preventDefault();
        dropZone.classList.add("drag");
      });
      dropZone.addEventListener("dragleave", () =>
        dropZone.classList.remove("drag"),
      );
      dropZone.addEventListener("drop", (e) => {
        e.preventDefault();
        dropZone.classList.remove("drag");
        if (e.dataTransfer.files[0]) setFile(e.dataTransfer.files[0]);
      });

      removeBtn.addEventListener("click", () => {
        selectedFile = null;
        fileInput.value = "";
        previewWrap.style.display = "none";
        dropZone.style.display = "block";
        btnExtract.disabled = true;
        clearError("error-step1");
      });

      /* ‚ïê‚ïê BANDUL PREVIEW ‚ïê‚ïê */
      bandulInput.addEventListener("input", () => {
        const v = parseFloat(bandulInput.value);
        btnValidate.disabled = isNaN(v) || v <= 0;
        if (!isNaN(v) && rawData) {
          // Hitung preview terra per kelompok
          let lines = [];
          rawData.kelompok.forEach((grp) => {
            const n = grp.baris.filter(
              (r) => r.ekor !== 0 || r.kg !== 0,
            ).length;
            const terra = (v * n).toFixed(1);
            lines.push(
              `${grp.nama}: ${v} √ó ${n} baris = <span>${terra} kg</span>`,
            );
          });
          bandulPreview.innerHTML = lines.join("<br>");
        } else {
          bandulPreview.innerHTML = "<span>‚Äî</span>";
        }
      });

      /* ‚ïê‚ïê STEP 1: EXTRACT ‚ïê‚ïê */
      btnExtract.addEventListener("click", async () => {
        if (!selectedFile) return;
        setLoading(
          true,
          "Membaca dokumen dengan Gemini AI...",
          "Preprocessing gambar & mengekstrak angka...",
        );
        clearError("error-step1");

        const fd = new FormData();
        fd.append("file", selectedFile);

        try {
          const res = await fetch("/api/extract", { method: "POST", body: fd });
          const json = await res.json();
          setLoading(false);

          if (!json.success) {
            showError("error-step1", json.error);
            return;
          }

          rawData = json.raw_data;
          adaBrutoTerra = json.ada_bruto_terra;
          barisRagu = json.baris_ragu || [];
          retryDilakukan = json.retry_dilakukan || false;

          if (adaBrutoTerra) {
            // Tampilkan step 2 bandul
            setStepActive(2);
            bandulSection.style.display = "block";
            // Update deskripsi bandul
            const desc = document.getElementById("bandul-desc");
            let kelompokInfo = rawData.kelompok
              .map((g) => {
                const n = g.baris.filter(
                  (r) => r.ekor !== 0 || r.kg !== 0,
                ).length;
                return `<strong>${g.nama}</strong>: ${n} baris rincian`;
              })
              .join(", ");
            desc.innerHTML = `Sistem mendeteksi baris <strong>Bruto</strong> dan <strong>Terra</strong> di dokumen ini.<br><br>
          Kelompok yang terdeteksi: ${kelompokInfo}<br><br>
          Rumus Terra: <strong>Nilai Bandul √ó Jumlah Baris Terisi</strong><br>
          Rumus Netto: <strong>Bruto ‚àí Terra</strong><br><br>
          Masukkan nilai bandul (berat bandul dalam kg) yang dipakai:`;
            document.getElementById("step1-section").style.opacity = "0.5";
            document.getElementById("step1-section").style.pointerEvents =
              "none";
            bandulInput.focus();
          } else {
            // Langsung validasi
            await doValidate(null);
          }
        } catch (e) {
          setLoading(false);
          showError("error-step1", "Gagal terhubung ke server: " + e.message);
        }
      });

      /* ‚ïê‚ïê STEP 2: VALIDATE dengan bandul ‚ïê‚ïê */
      btnValidate.addEventListener("click", async () => {
        const bandul = parseFloat(bandulInput.value);
        if (isNaN(bandul) || bandul <= 0) {
          showError("error-bandul", "Masukkan nilai bandul yang valid");
          return;
        }
        clearError("error-bandul");
        await doValidate(bandul);
      });

      async function doValidate(bandul) {
        currentBandul = bandul; // simpan untuk recalc nanti
        setLoading(
          true,
          "Menghitung ulang semua nilai...",
          "Memvalidasi & menyusun rincian perhitungan...",
        );

        try {
          const res = await fetch("/api/validate", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ raw_data: rawData, bandul: bandul }),
          });
          const json = await res.json();
          setLoading(false);

          if (!json.success) {
            showError(
              adaBrutoTerra ? "error-bandul" : "error-step1",
              json.error,
            );
            return;
          }

          setStepActive(3);
          document.getElementById("step1-section").style.display = "none";
          bandulSection.style.display = "none";
          renderResults(json.result, barisRagu, retryDilakukan);
        } catch (e) {
          setLoading(false);
          showError("error-step1", "Gagal: " + e.message);
        }
      }

      /* ‚ïê‚ïê RESET ‚ïê‚ïê */
      btnReset.addEventListener("click", () => {
        selectedFile = null;
        rawData = null;
        adaBrutoTerra = false;
        barisRagu = [];
        retryDilakukan = false;
        currentBandul = null;
        if (rawData && rawData._extEdits) delete rawData._extEdits;
        rawData = null;
        fileInput.value = "";
        previewWrap.style.display = "none";
        dropZone.style.display = "block";
        btnExtract.disabled = true;
        bandulSection.style.display = "none";
        bandulInput.value = "";
        bandulPreview.innerHTML = "<span>‚Äî</span>";
        btnValidate.disabled = true;
        results.style.display = "none";
        const epw = document.getElementById("ext-panel-wrap");
        if (epw) epw.innerHTML = "";
        const oldRaguWarn = document.getElementById("ragu-warning");
        if (oldRaguWarn) oldRaguWarn.remove();
        document.getElementById("step1-section").style.opacity = "";
        document.getElementById("step1-section").style.pointerEvents = "";
        document.getElementById("step1-section").style.display = "";
        setStepActive(1);
        window.scrollTo({ top: 0, behavior: "smooth" });
      });

      /* ‚ïê‚ïê UI HELPERS ‚ïê‚ïê */
      function setLoading(show, msg = "", step = "") {
        loading.style.display = show ? "block" : "none";
        loadMsg.textContent = msg;
        loadStep.textContent = step;
        if (show) {
          results.style.display = "none";
        }
      }

      function showError(id, msg) {
        let el = document.getElementById(id);
        if (!el) {
          el = document.createElement("div");
          el.id = id;
        }
        el.className = "error-box";
        el.textContent = "‚ö† " + msg;
        el.style.display = "block";
      }

      function clearError(id) {
        const el = document.getElementById(id);
        if (el) el.style.display = "none";
      }

      function setStepActive(n) {
        [1, 2, 3].forEach((i) => {
          const el = document.getElementById(`step${i}-indicator`);
          el.className =
            "step-item " + (i < n ? "done" : i === n ? "active" : "");
        });
      }

      /* ‚ïê‚ïê FORMAT NUMBER ‚ïê‚ïê */
      function fmt(n) {
        if (n === null || n === undefined) return "‚Äî";
        const f = parseFloat(parseFloat(n).toFixed(4));
        return f % 1 === 0 ? f.toFixed(0) : parseFloat(f.toFixed(3)).toString();
      }

      /* ‚ïê‚ïê BUILD FORMULA HTML ‚ïê‚ïê */
      function buildFormulaHTML(c) {
        let html = "";

        // Penjumlahan list (jika ada)
        if (c.nilai_list && c.nilai_list.length > 0) {
          const MAX = 25;
          let parts;
          if (c.nilai_list.length <= MAX) {
            parts = c.nilai_list.map(
              (v) => `<span class="fn">${fmt(v)}</span>`,
            );
          } else {
            const head = c.nilai_list
              .slice(0, 10)
              .map((v) => `<span class="fn">${fmt(v)}</span>`);
            const tail = c.nilai_list
              .slice(-10)
              .map((v) => `<span class="fn">${fmt(v)}</span>`);
            const skip = c.nilai_list.length - 20;
            parts = [
              ...head,
              `<span style="color:var(--muted)">‚Ä¶(${skip} nilai)‚Ä¶</span>`,
              ...tail,
            ];
          }
          html += `<span class="line">${parts.join('<span class="op"> + </span>')} <span class="op"> = </span> <span class="res">${fmt(c.hitung)} ${c.satuan}</span></span>`;
        }

        // Formula turunan (Bruto-Terra, Terra=bandul√ón, Rata-rata)
        if (c.formula_extra) {
          const lines = c.formula_extra.split("\n");
          lines.forEach((l, i) => {
            const isResult = i === lines.length - 1;
            html += `<span class="line derived ${isResult ? "res-line" : ""}">${escHtml(l)}</span>`;
          });
        }

        return html || `<span class="fn">(tidak ada data)</span>`;
      }

      function escHtml(s) {
        return s
          .replace(/&/g, "&amp;")
          .replace(/</g, "&lt;")
          .replace(/>/g, "&gt;");
      }

      /* ‚ïê‚ïê RENDER RESULTS ‚ïê‚ïê */
      function renderResults(result, barisRaguList, isRetry, isManualRecalc) {
        const {
          checks,
          semua_benar,
          jumlah_salah,
          ada_bruto_terra,
          bandul_digunakan,
          kelompok,
          ringkasan_atas,
        } = result;

        // Banner
        const banner = document.getElementById("banner");
        if (semua_benar) {
          banner.className = "banner ok";
          document.getElementById("banner-ico").textContent = "‚úÖ";
          document.getElementById("banner-title").textContent =
            "Semua Hitungan Benar";
          document.getElementById("banner-sub").textContent =
            "Seluruh nilai total di dokumen sesuai dengan penjumlahan data baris.";
        } else {
          banner.className = "banner error";
          document.getElementById("banner-ico").textContent = "‚ùå";
          document.getElementById("banner-title").textContent =
            `${jumlah_salah} Ketidaksesuaian Ditemukan`;
          document.getElementById("banner-sub").textContent =
            "Ada nilai total yang TIDAK cocok dengan perhitungan dari data baris. Lihat rincian di bawah.";
        }

        // Meta tags
        const meta = document.getElementById("banner-meta");
        meta.innerHTML = "";
        const tags = [
          {
            label: ada_bruto_terra
              ? "Format: Bruto/Terra/Netto"
              : "Format: Tanpa Bruto/Terra",
            hi: false,
          },
          { label: `${kelompok.length} Kelompok Kolom`, hi: false },
          { label: `${checks.length} Poin Dicek`, hi: false },
        ];
        if (ada_bruto_terra && bandul_digunakan !== null) {
          tags.push({ label: `Bandul: ${fmt(bandul_digunakan)} kg`, hi: true });
        }
        if (isRetry) {
          tags.push({
            label: "üîÑ Re-read otomatis dilakukan",
            hi: false,
            extra: "retry-tag",
          });
        }
        if (isManualRecalc) {
          tags.push({
            label: "‚úè Dihitung ulang dengan koreksi manual",
            hi: true,
          });
        }
        if (barisRaguList && barisRaguList.length > 0) {
          tags.push({
            label: `‚ö† ${barisRaguList.length} baris diragukan`,
            hi: false,
          });
        }
        tags.forEach((t) => {
          const span = document.createElement("span");
          span.className =
            "meta-tag" +
            (t.hi ? " highlight" : "") +
            (t.extra ? ` ${t.extra}` : "");
          span.textContent = t.label;
          meta.appendChild(span);
        });

        // ‚îÄ‚îÄ Baris Ragu Warning ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        // Hapus warning lama jika ada
        const oldRaguWarn = document.getElementById("ragu-warning");
        if (oldRaguWarn) oldRaguWarn.remove();

        if (barisRaguList && barisRaguList.length > 0) {
          const raguDiv = document.createElement("div");
          raguDiv.id = "ragu-warning";
          raguDiv.className = "ragu-banner";

          const itemsHTML = barisRaguList
            .map(
              (r) =>
                `<span class="ragu-item">${r.kelompok} Baris ${r.no} (${r.ekor} ekor / ${fmt(r.kg)} kg)</span>`,
            )
            .join("");

          raguDiv.innerHTML = `
        <div class="ragu-banner-ico">‚ö†Ô∏è</div>
        <div class="ragu-banner-body">
          <h4>Perhatian ‚Äî ${barisRaguList.length} Baris Perlu Dicek Manual</h4>
          <p>
            Gemini AI menandai baris berikut karena <strong>tulisan tangan sulit dibaca</strong>,
            kemungkinan ada angka yang mirip (seperti 4 vs 9, 6 vs 0).
            Silakan cocokkan dengan dokumen asli:
          </p>
          <div class="ragu-list">${itemsHTML}</div>
        </div>
      `;

          // Sisipkan setelah banner
          document.getElementById("banner").after(raguDiv);
        }

        // Checks list
        const list = document.getElementById("checks-list");
        list.innerHTML = "";
        checks.forEach((c, i) => {
          const card = document.createElement("div");
          card.className = "check-card " + (c.ok ? "ok" : "err");

          const selisihHTML = !c.ok
            ? `<span class="selisih-tag">Œî ${c.selisih > 0 ? "+" : ""}${parseFloat(c.selisih.toFixed(3))}</span>`
            : "";

          const formulaHTML = buildFormulaHTML(c);
          const autoOpen = !c.ok;

          card.innerHTML = `
        <div class="cc-head" onclick="toggleCard(this)">
          <div class="cc-left">
            <span class="cc-kategori">${c.kategori}</span>
            <span class="cc-label">${c.label}</span>
          </div>
          <div class="cc-right">
            ${selisihHTML}
            <div class="cc-nums">
              <div class="cc-num h">
                <div class="lbl">HITUNGAN</div>
                <div class="val">${fmt(c.hitung)} <span style="font-size:10px;font-weight:400;color:var(--muted)">${c.satuan}</span></div>
              </div>
              <div class="cc-num t">
                <div class="lbl">TERTULIS</div>
                <div class="val">${fmt(c.tertulis)}</div>
              </div>
            </div>
            <span class="badge ${c.ok ? "ok" : "err"}">${c.ok ? "‚úì BENAR" : "‚úó SALAH"}</span>
            <span class="cc-arrow ${autoOpen ? "open" : ""}">‚ñº</span>
          </div>
        </div>
        <div class="cc-body ${autoOpen ? "show" : ""}" id="body-${i}">
          <div class="rincian-wrap">
            <div class="rincian-title">Rincian Perhitungan</div>
            <div class="formula-box">${formulaHTML}</div>
            <div class="kesimpulan ${c.ok ? "ok" : "err"}">${c.kesimpulan}</div>
          </div>
        </div>
      `;
          list.appendChild(card);
        });

        // ‚îÄ‚îÄ Extraction Panel (semua nilai tertulis, selalu bisa diedit) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        renderExtractionPanel(kelompok, ringkasan_atas, ada_bruto_terra);

        // Tabel per kelompok ‚Äî hanya baris rincian + baris HITUNG di footer
        const grpTables = document.getElementById("grp-tables");
        grpTables.innerHTML = "";
        kelompok.forEach((grp, grpIdx) => {
          const ekorCheck = checks.find(
            (c) => c.id === `ekor_${grp.nama.toLowerCase()}`,
          );
          const brutoCheck = checks.find(
            (c) => c.id === `bruto_${grp.nama.toLowerCase()}`,
          );
          const nettoCheck = checks.find(
            (c) => c.id === `netto_${grp.nama.toLowerCase()}`,
          );

          const hEkor = ekorCheck ? fmt(ekorCheck.hitung) : "‚Äî";
          const hBruto = brutoCheck
            ? fmt(brutoCheck.hitung)
            : ada_bruto_terra
              ? "‚Äî"
              : null;
          const hNetto = nettoCheck ? fmt(nettoCheck.hitung) : "‚Äî";

          const eMismatch = ekorCheck && !ekorCheck.ok;
          const bMismatch = brutoCheck && !brutoCheck.ok;
          const nMismatch = nettoCheck && !nettoCheck.ok;
          const colLabel = ada_bruto_terra ? "BRUTO (KG)" : "KG";

          const div = document.createElement("div");
          div.className = "grp-table-card";
          div.dataset.grpIdx = grpIdx;
          div.innerHTML = `
        <div class="grp-table-head">
          <span>${grp.nama} (${grp.posisi})</span>
          <div style="display:flex;align-items:center;gap:10px">
            <span style="color:var(--muted2);font-size:11px">${grp.baris.filter((r) => r.ekor || r.kg).length} baris</span>
            <span class="edit-toggle" onclick="toggleEditMode(this, ${grpIdx})">‚úé Edit Baris</span>
          </div>
        </div>
        <div class="tbl-wrap">
          <table>
            <thead><tr><th>NO</th><th>EKOR</th><th>${colLabel}</th></tr></thead>
            <tbody id="tbody-${grpIdx}"></tbody>
            <tfoot>
              <tr class="tfoot-row">
                <td class="val-label">HITUNG</td>
                <td class="val-hitung ${eMismatch ? "val-mismatch" : ""}">${hEkor}</td>
                <td class="val-hitung ${bMismatch || nMismatch ? "val-mismatch" : ""}">${hBruto !== null ? hBruto : hNetto}</td>
              </tr>
            </tfoot>
          </table>
        </div>
      `;
          grpTables.appendChild(div);
          renderTbody(grpIdx, grp.baris);
        });

        results.style.display = "block";
        results.scrollIntoView({ behavior: "smooth", block: "start" });
      }

      /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     PANEL KOREKSI NILAI EKSTRAKSI
     Semua nilai "tertulis" yang diekstrak Gemini ditampilkan di sini
     dan SELALU bisa diedit tanpa perlu toggle mode.
  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
      function renderExtractionPanel(
        kelompok,
        ringkasan_atas,
        ada_bruto_terra,
      ) {
        const wrap = document.getElementById("ext-panel-wrap");
        wrap.innerHTML = "";

        const panel = document.createElement("div");
        panel.className = "ext-panel";
        panel.innerHTML = `
      <div class="ext-panel-head">
        <h4>NILAI TERTULIS HASIL EKSTRAKSI ‚Äî Klik nilai mana saja untuk koreksi</h4>
        <span class="ext-panel-hint">‚úé semua nilai bisa diedit</span>
      </div>
      <div class="ext-panel-body" id="ext-body"></div>
    `;
        wrap.appendChild(panel);
        const body = document.getElementById("ext-body");

        // ‚îÄ‚îÄ Per kelompok ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        kelompok.forEach((grp, grpIdx) => {
          const grpDiv = document.createElement("div");
          grpDiv.className = "ext-group";

          const fields = [];
          fields.push({
            key: "tertulis_total_ekor",
            label: "Total Ekor",
            unit: "ekor",
            step: 1,
            src: "kelompok",
            grpIdx,
          });
          if (ada_bruto_terra) {
            fields.push({
              key: "tertulis_bruto_kg",
              label: "Bruto",
              unit: "kg",
              step: 0.1,
              src: "kelompok",
              grpIdx,
            });
            fields.push({
              key: "tertulis_terra_kg",
              label: "Terra",
              unit: "kg",
              step: 0.1,
              src: "kelompok",
              grpIdx,
            });
          }
          fields.push({
            key: "tertulis_netto_kg",
            label: "Netto",
            unit: "kg",
            step: 0.1,
            src: "kelompok",
            grpIdx,
          });

          const fieldsDiv = document.createElement("div");
          fieldsDiv.className = "ext-fields";

          fields.forEach((f) => {
            const currentVal = rawData.kelompok[grpIdx][f.key];
            if (currentVal === null || currentVal === undefined) return;
            const el = makeExtField(f, currentVal);
            fieldsDiv.appendChild(el);
          });

          grpDiv.innerHTML = `<div class="ext-group-label">${grp.nama} (${grp.posisi})</div>`;
          grpDiv.appendChild(fieldsDiv);
          body.appendChild(grpDiv);
        });

        // ‚îÄ‚îÄ Ringkasan Atas ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        const atasDiv = document.createElement("div");
        atasDiv.className = "ext-group";

        const atasFields = [
          {
            key: "tertulis_realisasi_ekor",
            label: "Realisasi Ekor",
            unit: "ekor",
            step: 1,
            src: "atas",
          },
          {
            key: "tertulis_realisasi_kg",
            label: "Realisasi KG",
            unit: "kg",
            step: 0.1,
            src: "atas",
          },
          {
            key: "tertulis_rata_rata",
            label: "Rata-rata",
            unit: "kg/ekor",
            step: 0.01,
            src: "atas",
          },
        ];

        const atasFieldsDiv = document.createElement("div");
        atasFieldsDiv.className = "ext-fields";

        atasFields.forEach((f) => {
          const currentVal = rawData.ringkasan_atas[f.key];
          if (currentVal === null || currentVal === undefined) return;
          const el = makeExtField(f, currentVal);
          atasFieldsDiv.appendChild(el);
        });

        atasDiv.innerHTML = `<div class="ext-group-label">RINGKASAN ATAS (Total Keseluruhan)</div>`;
        atasDiv.appendChild(atasFieldsDiv);
        body.appendChild(atasDiv);
      }

      /* ‚îÄ‚îÄ Buat satu field di extraction panel ‚îÄ‚îÄ */
      function makeExtField(fieldDef, currentVal) {
        const el = document.createElement("div");
        el.className = "ext-field";
        el.dataset.efKey = fieldDef.key;
        el.dataset.efSrc = fieldDef.src;
        if (fieldDef.grpIdx !== undefined)
          el.dataset.efGrpIdx = fieldDef.grpIdx;

        const isEdited =
          rawData._extEdits &&
          rawData._extEdits[
            `${fieldDef.src}:${fieldDef.grpIdx}:${fieldDef.key}`
          ];
        const origVal = isEdited ? isEdited.from : null;
        if (isEdited) el.classList.add("ef-edited");

        el.innerHTML = `
      <span class="ef-edit-hint">‚úé</span>
      <div class="ef-label">${fieldDef.label}</div>
      <div class="ef-val">${fmt(currentVal)}<span class="ef-unit">${fieldDef.unit}</span></div>
      ${isEdited ? `<div class="ef-orig">${fmt(origVal)}</div>` : ""}
    `;

        el.addEventListener("click", () =>
          startExtFieldEdit(el, fieldDef, currentVal),
        );
        return el;
      }

      /* ‚îÄ‚îÄ Edit satu field di extraction panel ‚îÄ‚îÄ */
      function startExtFieldEdit(el, fieldDef, currentVal) {
        if (el.classList.contains("ef-editing")) return;
        el.classList.add("ef-editing");
        el.innerHTML = "";

        const input = document.createElement("input");
        input.type = "number";
        input.step = fieldDef.step;
        input.min = "0";
        input.value = currentVal;
        el.appendChild(input);
        input.focus();
        input.select();

        function commit() {
          const newVal = parseFloat(input.value);
          el.classList.remove("ef-editing");

          if (!isNaN(newVal) && newVal !== currentVal) {
            // Update rawData
            if (fieldDef.src === "kelompok") {
              rawData.kelompok[fieldDef.grpIdx][fieldDef.key] = newVal;
            } else {
              rawData.ringkasan_atas[fieldDef.key] = newVal;
            }

            // Track original
            if (!rawData._extEdits) rawData._extEdits = {};
            const editKey = `${fieldDef.src}:${fieldDef.grpIdx}:${fieldDef.key}`;
            if (!rawData._extEdits[editKey])
              rawData._extEdits[editKey] = { from: currentVal };
            rawData._extEdits[editKey].to = newVal;

            // Re-render this field dengan state edited
            const origVal = rawData._extEdits[editKey].from;
            el.classList.add("ef-edited");
            el.innerHTML = `
          <span class="ef-edit-hint">‚úé</span>
          <div class="ef-label">${fieldDef.label}</div>
          <div class="ef-val">${fmt(newVal)}<span class="ef-unit">${fieldDef.unit}</span></div>
          <div class="ef-orig">${fmt(origVal)}</div>
        `;
            el.addEventListener("click", () =>
              startExtFieldEdit(el, fieldDef, newVal),
            );

            const labelDisplay =
              fieldDef.src === "kelompok"
                ? `${rawData.kelompok[fieldDef.grpIdx].nama} ‚Üí ${fieldDef.label}`
                : `Ringkasan Atas ‚Üí ${fieldDef.label}`;

            registerChange(
              `ext:${fieldDef.src}:${fieldDef.grpIdx}`,
              null,
              fieldDef.key,
              currentVal,
              newVal,
              labelDisplay,
            );
          } else {
            // Tidak berubah ‚Äî restore tampilan
            el.innerHTML = `
          <span class="ef-edit-hint">‚úé</span>
          <div class="ef-label">${fieldDef.label}</div>
          <div class="ef-val">${fmt(currentVal)}<span class="ef-unit">${fieldDef.unit}</span></div>
        `;
            el.addEventListener("click", () =>
              startExtFieldEdit(el, fieldDef, currentVal),
            );
          }
        }

        input.addEventListener("blur", commit);
        input.addEventListener("keydown", (e) => {
          if (e.key === "Enter") {
            e.preventDefault();
            commit();
          }
          if (e.key === "Escape") {
            el.classList.remove("ef-editing");
            el.innerHTML = `
          <span class="ef-edit-hint">‚úé</span>
          <div class="ef-label">${fieldDef.label}</div>
          <div class="ef-val">${fmt(currentVal)}<span class="ef-unit">${fieldDef.unit}</span></div>
        `;
            el.addEventListener("click", () =>
              startExtFieldEdit(el, fieldDef, currentVal),
            );
          }
        });
      }

      /* ‚ïê‚ïê RENDER TBODY (reusable untuk initial + setelah edit) ‚ïê‚ïê */
      function renderTbody(grpIdx, baris) {
        const tbody = document.getElementById(`tbody-${grpIdx}`);
        if (!tbody) return;
        tbody.innerHTML = "";
        baris.forEach((r, rowIdx) => {
          const isRagu = r.ragu === true;
          const isEdited = r._edited === true;
          const raguClass = isRagu ? "row-ragu" : "";
          const editClass = isEdited ? "row-edited" : "";
          const tr = document.createElement("tr");
          tr.className = [raguClass, editClass].filter(Boolean).join(" ");
          if (isRagu) tr.title = "Baris ini ditandai meragukan oleh Gemini AI";

          // NO cell
          const tdNo = document.createElement("td");
          tdNo.textContent = r.no;
          tr.appendChild(tdNo);

          // EKOR cell
          const tdEkor = makeCellEditable(
            grpIdx,
            rowIdx,
            "ekor",
            r.ekor,
            isEdited,
            r._orig_ekor,
          );
          tr.appendChild(tdEkor);

          // KG cell
          const tdKg = makeCellEditable(
            grpIdx,
            rowIdx,
            "kg",
            r.kg,
            isEdited,
            r._orig_kg,
          );
          tr.appendChild(tdKg);

          tbody.appendChild(tr);
        });
      }

      /* ‚ïê‚ïê BUAT SEL EDITABLE ‚ïê‚ïê */
      function makeCellEditable(
        grpIdx,
        rowIdx,
        field,
        value,
        isEdited,
        origValue,
      ) {
        const td = document.createElement("td");
        td.className = "editable" + (isEdited ? " edited" : "");
        td.dataset.grpIdx = grpIdx;
        td.dataset.rowIdx = rowIdx;
        td.dataset.field = field;

        const displayVal = fmt(value);
        td.textContent = displayVal;

        if (isEdited && origValue !== undefined) {
          td.title = `Nilai asli: ${fmt(origValue)} ‚Üí Diubah ke: ${displayVal}`;
        }

        td.addEventListener("click", () =>
          startCellEdit(td, grpIdx, rowIdx, field),
        );
        return td;
      }

      /* ‚ïê‚ïê MODE EDIT PER TABEL (toggle) ‚ïê‚ïê */
      const editModes = {}; // grpIdx ‚Üí boolean

      function toggleEditMode(btn, grpIdx) {
        editModes[grpIdx] = !editModes[grpIdx];
        const tbody = document.getElementById(`tbody-${grpIdx}`);
        if (!tbody) return;

        if (editModes[grpIdx]) {
          btn.classList.add("active");
          btn.textContent = "‚úì Selesai Edit";
          // Enable tertulis cells juga
          enableTertulisEdit(grpIdx);
        } else {
          btn.classList.remove("active");
          btn.textContent = "‚úé Edit Nilai";
          // Commit any open input
          commitOpenInputs(grpIdx);
        }
      }

      /* ‚ïê‚ïê EDIT INLINE SEL ‚ïê‚ïê */
      function startCellEdit(td, grpIdx, rowIdx, field) {
        if (!editModes[grpIdx]) return;
        if (td.classList.contains("editing")) return;

        const currentVal = rawData.kelompok[grpIdx].baris[rowIdx][field];
        td.classList.add("editing");
        td.textContent = "";

        const input = document.createElement("input");
        input.type = "number";
        input.step = field === "kg" ? "0.1" : "1";
        input.min = "0";
        input.value = currentVal;
        td.appendChild(input);
        input.focus();
        input.select();

        function commit() {
          const newVal = parseFloat(input.value);
          td.classList.remove("editing");
          input.remove();

          if (!isNaN(newVal) && newVal !== currentVal) {
            const grp = rawData.kelompok[grpIdx];
            const row = grp.baris[rowIdx];

            // Simpan nilai asli jika belum pernah diedit
            if (!row._edited) {
              row[`_orig_ekor`] = row.ekor;
              row[`_orig_kg`] = row.kg;
            }

            row[field] = newVal;
            row._edited = true;
            td.classList.add("edited");
            td.textContent = fmt(newVal);
            td.title = `Nilai asli: ${fmt(field === "kg" ? row._orig_kg : row._orig_ekor)} ‚Üí Diubah ke: ${fmt(newVal)}`;

            // Update row class
            const tr = td.closest("tr");
            if (tr) tr.classList.add("row-edited");

            registerChange(grpIdx, rowIdx, field, currentVal, newVal);
          } else {
            td.textContent = fmt(currentVal);
          }
        }

        input.addEventListener("blur", commit);
        input.addEventListener("keydown", (e) => {
          if (e.key === "Enter") {
            e.preventDefault();
            commit();
          }
          if (e.key === "Escape") {
            td.classList.remove("editing");
            input.remove();
            td.textContent = fmt(currentVal);
          }
        });
      }

      /* ‚ïê‚ïê EDIT NILAI TERTULIS (lama ‚Äî diganti ext panel) ‚ïê‚ïê */
      // enableTertulisEdit dan startTertulisEdit sudah tidak digunakan.
      // Semua edit nilai tertulis sekarang dilakukan via renderExtractionPanel.

      function commitOpenInputs(grpIdx) {
        const card = document.querySelector(`[data-grp-idx="${grpIdx}"]`);
        if (!card) return;
        card.querySelectorAll(".editing input").forEach((inp) => inp.blur());
      }

      /* ‚ïê‚ïê CHANGE TRACKER ‚ïê‚ïê */
      const pendingChanges = []; // [{grpIdx, rowIdx, field, from, to, label?}]

      function registerChange(grpIdx, rowIdx, field, from, to, labelOverride) {
        const key = `${grpIdx}|${rowIdx}|${field}`;
        const existing = pendingChanges.find(
          (c) => `${c.grpIdx}|${c.rowIdx}|${c.field}` === key,
        );
        if (existing) {
          existing.to = to;
          if (existing.to === existing.from)
            pendingChanges.splice(pendingChanges.indexOf(existing), 1);
        } else {
          pendingChanges.push({
            grpIdx,
            rowIdx,
            field,
            from,
            to,
            label: labelOverride,
          });
        }
        updateRecalcBar();
      }

      function updateRecalcBar() {
        const bar = document.getElementById("recalc-bar");
        const changesDiv = document.getElementById("recalc-changes");

        if (pendingChanges.length === 0) {
          bar.style.display = "none";
          return;
        }

        bar.style.display = "block";
        changesDiv.innerHTML = "";

        pendingChanges.forEach((c) => {
          let label = c.label;
          if (!label) {
            // Baris rincian
            const grpIdxNum = typeof c.grpIdx === "number" ? c.grpIdx : null;
            if (grpIdxNum !== null && rawData.kelompok[grpIdxNum]) {
              const grp = rawData.kelompok[grpIdxNum];
              label = `${grp.nama} Baris ${c.rowIdx !== null ? c.rowIdx + 1 : "?"} [${c.field.toUpperCase()}]: ${fmt(c.from)} ‚Üí ${fmt(c.to)}`;
            } else {
              label = `${c.field}: ${fmt(c.from)} ‚Üí ${fmt(c.to)}`;
            }
          } else {
            label = `${label}: ${fmt(c.from)} ‚Üí ${fmt(c.to)}`;
          }
          const chip = document.createElement("span");
          chip.className = "change-chip";
          chip.textContent = label;
          changesDiv.appendChild(chip);
        });
      }

      /* ‚ïê‚ïê RECALCULATE ‚ïê‚ïê */
      document
        .getElementById("recalc-btn")
        .addEventListener("click", async () => {
          if (pendingChanges.length === 0) return;

          // Commit semua input yang masih terbuka
          document.querySelectorAll(".grp-table-card").forEach((card, i) => {
            commitOpenInputs(i);
          });

          setLoading(
            true,
            "Menghitung ulang dengan nilai koreksi...",
            "Memvalidasi semua total...",
          );
          document.getElementById("results").style.display = "none";

          try {
            const res = await fetch("/api/validate", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({
                raw_data: rawData,
                bandul: currentBandul,
              }),
            });
            const json = await res.json();
            setLoading(false);

            if (!json.success) {
              showError("error-step1", json.error);
              return;
            }

            // Tandai di banner bahwa ini hasil koreksi manual
            barisRagu = json.result ? [] : barisRagu; // jika ada koreksi, reset ragu
            retryDilakukan = false;

            renderResults(json.result, [], false, true /* isManualRecalc */);

            // Hide recalc bar & clear pending
            document.getElementById("recalc-bar").style.display = "none";
            pendingChanges.length = 0;
            if (rawData._extEdits) delete rawData._extEdits;
          } catch (e) {
            setLoading(false);
            showError("error-step1", "Gagal: " + e.message);
          }
        });

      /* Batalkan semua perubahan */
      document
        .getElementById("recalc-discard")
        .addEventListener("click", () => {
          if (
            !confirm(
              "Batalkan semua perubahan dan kembalikan nilai asal hasil ekstraksi?",
            )
          )
            return;

          // Reset baris rincian
          rawData.kelompok.forEach((grp) => {
            grp.baris.forEach((row) => {
              if (row._edited) {
                row.ekor = row._orig_ekor;
                row.kg = row._orig_kg;
                delete row._edited;
                delete row._orig_ekor;
                delete row._orig_kg;
              }
            });
          });

          // Reset nilai tertulis kelompok (ext panel)
          if (rawData._extEdits) {
            Object.entries(rawData._extEdits).forEach(([editKey, edit]) => {
              const [src, grpIdxStr, field] = editKey.split(":");
              if (src === "kelompok") {
                rawData.kelompok[parseInt(grpIdxStr)][field] = edit.from;
              } else if (src === "atas") {
                rawData.ringkasan_atas[field] = edit.from;
              }
            });
            delete rawData._extEdits;
          }

          pendingChanges.length = 0;
          document.getElementById("recalc-bar").style.display = "none";

          // Re-render baris
          rawData.kelompok.forEach((grp, i) => renderTbody(i, grp.baris));

          // Re-render ext panel
          renderExtractionPanel(
            rawData.kelompok,
            rawData.ringkasan_atas,
            adaBrutoTerra,
          );

          // Reset row highlights
          document.querySelectorAll(".edited, .row-edited").forEach((el) => {
            el.classList.remove("edited", "row-edited");
            el.title = "";
          });
        });

      /* ‚îÄ‚îÄ Toggle card ‚îÄ‚îÄ */
      function toggleCard(head) {
        const cards = [...document.querySelectorAll(".check-card")];
        const idx = cards.indexOf(head.closest(".check-card"));
        const body = document.getElementById(`body-${idx}`);
        const arrow = head.querySelector(".cc-arrow");
        body.classList.toggle("show");
        arrow.classList.toggle("open");
      }
    </script>
  </body>
</html>
